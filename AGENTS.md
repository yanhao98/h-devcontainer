# AI Agent ç¼–ç è§„èŒƒ

## Shell è„šæœ¬è§„èŒƒ

### è¾“å‡ºé‡å®šå‘è§„åˆ™

1. **ä¸è¦ä¸¢å¼ƒå­è„šæœ¬æˆ–å‘½ä»¤çš„è¾“å‡º**ï¼šåº”è¯¥å°†è¾“å‡ºé‡å®šå‘åˆ° stderr (`>&2`)ï¼Œè€Œä¸æ˜¯ä¸¢å¼ƒåˆ° `/dev/null`ã€‚

   ```bash
   # âŒ é”™è¯¯ï¼šä¸¢å¼ƒè¾“å‡º
   _verify_checksum "$file" "$checksum" 2>/dev/null
   some_command &>/dev/null

   # âœ… æ­£ç¡®ï¼šé‡å®šå‘åˆ° stderr
   _verify_checksum "$file" "$checksum" >&2
   some_command >&2
   ```

2. **å…è®¸ä¸¢å¼ƒè¾“å‡ºçš„ä¾‹å¤–æƒ…å†µ**ï¼š
   - `grep -q` æ£€æŸ¥æ–‡ä»¶å†…å®¹æ—¶ï¼ˆæ–‡ä»¶å¯èƒ½ä¸å­˜åœ¨ï¼‰ï¼š`grep -q 'pattern' file 2>/dev/null`
   - `dpkg --status` æ£€æŸ¥åŒ…æ˜¯å¦å®‰è£…æ—¶ï¼ˆåªå…³å¿ƒé€€å‡ºç ï¼‰
   - `nohup ... &` åå°è¿›ç¨‹
   - `tee > /dev/null` é¿å…é‡å¤è¾“å‡ºåˆ°ç»ˆç«¯

3. **è„šæœ¬ä¸­çš„æ‰€æœ‰ç”¨æˆ·æç¤ºä¿¡æ¯éƒ½åº”è¾“å‡ºåˆ° stderr**ï¼š
   ```bash
   echo "ğŸ” æ­£åœ¨è·å–ç‰ˆæœ¬ä¿¡æ¯..." >&2
   echo "âœ… å®‰è£…æˆåŠŸ" >&2
   ```

## bin-priority ç›®å½•

`/usr/local/bin-priority` ç›®å½•ç”¨äºå­˜æ”¾**æŒ‰éœ€è‡ªåŠ¨å®‰è£…**çš„è„šæœ¬ï¼Œä¼˜å…ˆçº§é«˜äºç³»ç»Ÿ PATHã€‚

### ç›®çš„

å½“ç”¨æˆ·ç¬¬ä¸€æ¬¡è¿è¡ŒæŸä¸ªå‘½ä»¤æ—¶ï¼Œå¦‚æœè¯¥å·¥å…·æœªå®‰è£…ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨å®‰è£…å®ƒï¼Œç„¶åè½¬å‘æ‰§è¡ŒçœŸæ­£çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ç”¨æˆ·æ— éœ€æ‰‹åŠ¨å®‰è£…ï¼Œç›´æ¥ä½¿ç”¨å‘½ä»¤å³å¯è§¦å‘è‡ªåŠ¨å®‰è£…ã€‚

### è„šæœ¬ç±»å‹

1. **çº¯ shim å«ç‰‡**ï¼šåªåšå®‰è£… + è½¬å‘
   - ç¤ºä¾‹ï¼š`bun`ã€`pnpm`ã€`node`ã€`uv`ã€`uvx`
   - ä½¿ç”¨ `_get-real-bin` æŸ¥æ‰¾çœŸå®äºŒè¿›åˆ¶æ–‡ä»¶
   - ä½¿ç”¨ `h-setup-*-bin` è„šæœ¬å®‰è£…

2. **åŒ…è£…å™¨/å¯åŠ¨å™¨**ï¼šå®‰è£… npm åŒ… + é¢å¤–é…ç½®/å‚æ•°å¤„ç† + æ‰§è¡Œ
   - ç¤ºä¾‹ï¼š`claude`ã€`gemini`ã€`codex`ã€`qwen`ã€`iflow`ã€`opencode`
   - ä½¿ç”¨ `add-bun-priority-bin-pkg` å®‰è£… npm åŒ…åˆ° `/vscode/bun-priority-bin/`
   - ä½¿ç”¨ `bun --bun run` æ‰§è¡Œ
   - å¯èƒ½åŒ…å«é…ç½®åˆå§‹åŒ–ã€ç¯å¢ƒå˜é‡è®¾ç½®ç­‰é¢å¤–é€»è¾‘

### ç¼–å†™æ–°çš„ shim è„šæœ¬

å‚è€ƒæ¨¡æ¿ï¼ˆä»…é€‚ç”¨äº**çº¯ shim å«ç‰‡**ï¼Œä¸é€‚ç”¨äºåŒ…è£…å™¨/å¯åŠ¨å™¨ï¼‰ï¼š
```bash
#!/bin/bash
set -o errexit
set -o nounset
set -o pipefail

# <tool> shim: è‡ªåŠ¨æ£€æµ‹å¹¶å®‰è£… <tool>ï¼Œç„¶åæ‰§è¡Œ

source /devcontainer/shim-utils.sh
_print_caller_info

tool_bin="$(_get-real-bin <tool> || true)"

if [ -z "$tool_bin" ]; then
    echo "âš ï¸  <tool> æœªå®‰è£…ï¼Œæ­£åœ¨è‡ªåŠ¨å®‰è£…..." >&2
    h-setup-<tool>-bin >&2
    tool_bin="$(_get-real-bin <tool> || true)"
    if [ -z "$tool_bin" ]; then
        echo "âŒ <tool> å®‰è£…å¤±è´¥" >&2
        exit 1
    fi
fi

echo -e "\e[90mâ†’ exec $tool_bin\e[0m" >&2
exec "$tool_bin" "$@"
```
