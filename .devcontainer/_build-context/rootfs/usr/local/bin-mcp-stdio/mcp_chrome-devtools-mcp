#!/bin/bash
set -o errexit    # 对应 -e
set -o nounset    # 对应 -u
set -o pipefail   # 对应 -o pipefail

if ! dpkg --status chromium &>/dev/null; then
  # 创建临时 apt 配置，启用锁等待（-1 表示无限等待）
  APT_WAIT_CONF=$(mktemp)
  echo 'DPkg::Lock::Timeout "-1";' > "$APT_WAIT_CONF"
  export APT_CONFIG="$APT_WAIT_CONF"
  
  _curl-fsSL--compressed https://Git.1-H.CC/Scripts/Linux/raw/branch/2026/devcontainer/apt-install-with-cache.sh | sudo -E bash -s -- \
    chromium chromium-l10n ffmpeg
  
  rm -f "$APT_WAIT_CONF"
fi

# claude mcp add --transport stdio --scope=user chrome-devtools -- mcp_chrome-devtools-mcp

add-bun-priority-bin-pkg chrome-devtools-mcp@latest

BUN_ARGS=()
BUN_ARGS+=("--bun")
BUN_ARGS+=("run")
BUN_ARGS+=("/vscode/bun-priority-bin/node_modules/.bin/chrome-devtools-mcp")

BIN_ARGS=()
BIN_ARGS+=("--isolated")
BIN_ARGS+=("--executablePath=/usr/local/bin-priority/chromium")

exec bun "${BUN_ARGS[@]}" "${BIN_ARGS[@]}" "$@"
