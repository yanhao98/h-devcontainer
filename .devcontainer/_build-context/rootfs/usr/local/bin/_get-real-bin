#!/bin/bash
# é€šç”¨å‡½æ•°ï¼šæŸ¥æ‰¾é bin-priority ç›®å½•ä¸‹çš„ç¬¬ä¸€ä¸ªæŒ‡å®šå¯æ‰§è¡Œæ–‡ä»¶
# ç”¨æ³•: _get-real-bin <å‘½ä»¤å>
# ç¤ºä¾‹: _get-real-bin node

set -o errexit
set -o nounset
set -o pipefail

if [[ $# -lt 1 ]]; then
    echo "ç”¨æ³•: _get-real-bin <å‘½ä»¤å>" >&2
    exit 1
fi

cmd="$1"

while IFS= read -r p; do
    # è·³è¿‡æ‰€æœ‰ bin-priority ç›®å½•ä¸‹çš„å¯æ‰§è¡Œæ–‡ä»¶
    if [[ "$p" != */bin-priority/* ]]; then
        echo -e "\e[90mğŸ” Found real binary: $p\e[0m" >&2
        echo "$p"
        exit 0
    fi
done < <(which -a "$cmd" 2>/dev/null)

echo "âŒ Error: Could not find real binary for $cmd" >&2
exit 1
