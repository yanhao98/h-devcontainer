#!/bin/bash
# é€šç”¨å‡½æ•°ï¼šæŸ¥æ‰¾é bin-priority ç›®å½•ä¸‹çš„ç¬¬ä¸€ä¸ªæŒ‡å®šå¯æ‰§è¡Œæ–‡ä»¶
# ç”¨æ³•: _get-real-bin [--silent] <å‘½ä»¤å>
# ç¤ºä¾‹: _get-real-bin node
#       _get-real-bin --silent node   # é™é»˜æ¨¡å¼ï¼Œä¸è¾“å‡ºè¯Šæ–­ä¿¡æ¯

set -o errexit
set -o nounset
set -o pipefail

quiet=false
if [[ "${1:-}" == "--silent" ]]; then
    quiet=true
    shift
fi

if [[ $# -lt 1 ]]; then
    echo "ç”¨æ³•: _get-real-bin [--silent] <å‘½ä»¤å>" >&2
    exit 1
fi

cmd="$1"

while IFS= read -r p; do
    # è·³è¿‡æ‰€æœ‰ bin-priority ç›®å½•ä¸‹çš„å¯æ‰§è¡Œæ–‡ä»¶
    if [[ "$p" != */bin-priority/* ]]; then
        $quiet || echo -e "\e[90mğŸ” æ‰¾åˆ°çœŸå®äºŒè¿›åˆ¶æ–‡ä»¶: $p\e[0m" >&2
        echo "$p"
        exit 0
    fi
done < <(which -a "$cmd" 2>/dev/null)

$quiet || echo "âŒ æœªæ‰¾åˆ° $cmd çš„çœŸå®äºŒè¿›åˆ¶æ–‡ä»¶" >&2
$quiet || exit 1
