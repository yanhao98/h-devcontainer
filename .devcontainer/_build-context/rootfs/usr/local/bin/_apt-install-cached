#!/usr/bin/env bash
set -o errexit    # 对应 -e
set -o nounset    # 对应 -u
set -o pipefail   # 对应 -o pipefail

# Usage: _apt-install-cached package1 [package2...]
# Example: _apt-install-cached chromium chromium-l10n ffmpeg

if false; then
#-------------------------------------------------------------------------------------------------------------
# 一些资料：
# 查看该软件包安装的所有文件
dpkg -L tigervnc-standalone-server | grep bin
#-------------------------------------------------------------------------------------------------------------
fi

REMOTE_URL="https://Git.1-H.CC/Scripts/Linux/raw/branch/2026/devcontainer/apt-install-with-cache.sh"

if [[ $# -eq 0 ]]; then
  echo "❌ 错误: _apt-install-cached 未指定要安装的包。" >&2
  exit 1
fi

echo "📦 apt 安装: $*" >&2

# 创建临时 apt 配置，启用锁等待（-1 表示无限等待）
APT_WAIT_CONF=$(mktemp)
trap 'rm -f "$APT_WAIT_CONF"' EXIT
echo 'DPkg::Lock::Timeout "-1";' > "$APT_WAIT_CONF"
export APT_CONFIG="$APT_WAIT_CONF"

# -E 选项：保留（preserve）当前的环境变量
sudo -E _execute-remote-script "$REMOTE_URL" "$@"
