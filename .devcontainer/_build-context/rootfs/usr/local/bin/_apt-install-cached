#!/usr/bin/env bash
set -o errexit    # å¯¹åº” -e
set -o nounset    # å¯¹åº” -u
set -o pipefail   # å¯¹åº” -o pipefail

# Usage: _apt-install-cached package1 [package2...]
# Example: _apt-install-cached chromium chromium-l10n ffmpeg

if false; then
#-------------------------------------------------------------------------------------------------------------
# ä¸€äº›èµ„æ–™ï¼š
# æŸ¥çœ‹è¯¥è½¯ä»¶åŒ…å®‰è£…çš„æ‰€æœ‰æ–‡ä»¶
dpkg -L tigervnc-standalone-server | grep bin

# ä½ çš„ `vim` å‘½ä»¤åœ¨ç³»ç»Ÿé‡Œæ˜¯è¿™æ ·è·³è½¬çš„ï¼š
# 1.  **ç¬¬ä¸€æ­¥**ï¼šä½ è¾“å…¥ `vim`ã€‚
# 2.  **ç¬¬äºŒæ­¥**ï¼šç³»ç»Ÿåœ¨ `/usr/bin/vim` æ‰¾åˆ°å…¥å£ã€‚
# 3.  **ç¬¬ä¸‰æ­¥**ï¼š`/usr/bin/vim` æŒ‡å‘ `/etc/alternatives/vim`ï¼ˆå¤‡é€‰æ–¹æ¡ˆè½¯é“¾æŽ¥ï¼‰ã€‚
# 4.  **ç¬¬å››æ­¥**ï¼ˆä½ åˆšæŸ¥åˆ°çš„ï¼‰ï¼š`/etc/alternatives/vim` æœ€ç»ˆæŒ‡å‘äº† **`/usr/bin/vim.basic`**ã€‚
#-------------------------------------------------------------------------------------------------------------
fi

REMOTE_URL="https://Git.1-H.CC/Scripts/Linux/raw/branch/2026/devcontainer/apt-install-with-cache.sh"

if [[ $# -eq 0 ]]; then
  echo "âŒ é”™è¯¯: _apt-install-cached æœªæŒ‡å®šè¦å®‰è£…çš„åŒ…ã€‚" >&2
  exit 1
fi

echo "ðŸ“¦ apt å®‰è£…: $*" >&2

# åˆ›å»ºä¸´æ—¶ apt é…ç½®ï¼Œå¯ç”¨é”ç­‰å¾…ï¼ˆ-1 è¡¨ç¤ºæ— é™ç­‰å¾…ï¼‰
APT_WAIT_CONF=$(mktemp)
trap 'rm -f "$APT_WAIT_CONF"' EXIT
echo 'DPkg::Lock::Timeout "-1";' > "$APT_WAIT_CONF"
export APT_CONFIG="$APT_WAIT_CONF"

# -E é€‰é¡¹ï¼šä¿ç•™ï¼ˆpreserveï¼‰å½“å‰çš„çŽ¯å¢ƒå˜é‡
# å®‰è£…æ—¥å¿—ç»Ÿä¸€èµ° stderrï¼Œé¿å…æ±¡æŸ“è°ƒç”¨æ–¹ stdoutï¼ˆä¾‹å¦‚å‘½ä»¤æ›¿æ¢æˆ–é‡å®šå‘åˆ°é…ç½®æ–‡ä»¶ï¼‰
sudo -E _execute-remote-script "$REMOTE_URL" "$@" >&2
