#!/bin/bash
set -o errexit
set -o nounset
set -o pipefail

# uvx shim: 自动检测并安装 uv（包含 uvx），然后执行
# @verify: uvx --version

source /devcontainer/shim-utils.sh
_print_caller_info

uvx_bin="$(_get-real-bin --silent uvx)"

if [ -z "$uvx_bin" ]; then
    echo "⚠️  uvx 未安装，正在自动安装 uv..." >&2
    # 重定向到 stderr，避免安装输出污染 stdout（其他工具可能捕获 uvx 的 stdout 来获取版本信息）
    h-setup-uv-bin >&2
fi

export UV_CACHE_DIR="/vscode/uv-cache"
exec _exec-real-bin uvx "$@"
