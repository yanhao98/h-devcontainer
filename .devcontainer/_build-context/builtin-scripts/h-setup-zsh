#!/bin/zsh -eu

TARGET_USER="usr_vscode"
if [[ "$EUID" -eq 0 ]]; then
  target_home="/home/${TARGET_USER}"
else
  target_home="$HOME"
fi

zshrc="${target_home}/.zshrc"
mkdir -p "${zshrc:h}"
touch "$zshrc"

vscode_marker='# >>>>> VS Code Shell Integration'
if ! grep -Fq "$vscode_marker" "$zshrc" 2>/dev/null; then
  cat <<'EOF' >>"$zshrc"

# >>>>> VS Code Shell Integration
if [[ "$TERM_PROGRAM" == "vscode" ]]; then
    if command -v code >/dev/null 2>&1; then
        . "$(code --locate-shell-integration-path zsh)"
    elif command -v code-insiders >/dev/null 2>&1; then
        . "$(code-insiders --locate-shell-integration-path zsh)"
    fi
fi
# <<<<< VS Code Shell Integration
EOF
fi

alias_marker='# h-devcontainers: custom aliases'
if ! grep -Fq "$alias_marker" "$zshrc" 2>/dev/null; then
cat <<'EOF' >>"$zshrc"

# h-devcontainers: custom aliases
alias clean-node-modules='setopt rm_star_silent; rm -rf node_modules/.*; rm -rf node_modules/*; unsetopt rm_star_silent'
EOF
fi
