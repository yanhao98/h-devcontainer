#!/bin/zsh -eu

# >>>>>> Gemini CLI 工具
bun add -g @google/gemini-cli@latest

if ! grep -q ">>>>> Gemini CLI" ~/.zshrc; then
cat <<'EOF' >> ~/.zshrc

# >>>>> Gemini CLI
alias gemini='bunx --bun -g gemini --yolo -m gemini-2.5-pro'
export SANDBOX=h-devcontainer
# <<<<< Gemini CLI
EOF
fi

if [[ "${1:-}" == "--config" ]]; then
  mkdir -p ~/.gemini || true
  if [[ -f ~/.gemini/settings.json ]]; then
    echo "Gemini CLI config already exists, skipping."
  else
    cat <<'EOF' > ~/.gemini/settings.json
{
  "security": {
    "auth": {
      "selectedType": "gemini-api-key"
    }
  },
  "ide": {
    "enabled": true
  }
}
EOF
  fi
fi
